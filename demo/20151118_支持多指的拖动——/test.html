<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title></title>
    <meta charset="UTF-8">
    <meta content="width=device-width,initial-scale=1.0,user-scalable=no" name="viewport" />
</head>
<body>
    

    <div style="width:300px;height:300px;background:#0094ff"></div>

    <script src="../../js/common.js"></script>
    <script>
        //#region css加前缀
        /*
    
        type: 
            0 或不给, 减号连接,真正的 css属性名 
            1, 驼峰, 适用直接给style赋值
        例子
        cssTransform = c.addPrefix('transform')
        */
        c.addPrefix = function (cssAttr, type) {
            var cssPrefixes = ["ms", "moz", "webkit"],
                style = document.body.style,
                _cssAttr = cssAttr.charAt(0).toUpperCase() + cssAttr.substr(1);

            if (style[cssAttr] !== undefined) {

                return cssAttr;
            }
            for (var i = cssPrefixes.length, newAttr, cssPf; i--;) {

                cssPf = cssPrefixes[i];
                newAttr = cssPf + _cssAttr;

                if (style[newAttr] !== undefined) {

                    return type ? newAttr : '-' + cssPf + '-' + cssAttr;
                }
            }
        };

        //#endregion

        //#region 取 css属性名，有前缀的
        /*
         * 单例模式，取过后的属性将保存，下次节省效率
         * 
         */

        c.getCssAttrName = function () {
            var obj = {};
            return function (name) {
                var styleName = obj[name];

                if (styleName === undefined) {
                    styleName = obj[name] = c.addPrefix(name);
                }


                return styleName;
            }
        }();

        //#endregion

        c.drag = function (eDrag, onMove, onDown, onUp) {

            var startX, startY, identifier;

            eDrag.addEventListener('touchstart', function (e) {
                console.log('开始',e);
                var touche = e.changedTouches[0];

                identifier = touche.identifier;
               
                console.log(e.touches.item(identifier));

                startY = touche.pageY;

                onDown(e);

            });

            eDrag.addEventListener('touchmove', function (e) {

                var touche = e.touches[identifier],
                    moveY;

               

                    moveY = touche.pageY - startY;

                    onMove({ top: moveY, event: e });
            });

            eDrag.addEventListener('touchend', function (e) {
                var touche = e.changedTouches[0];



                console.log(e);
                onUp(e);
            });

        };
        
        var
            eDrag = document.getElementsByTagName('div')[0]
            ,currentY = 0, y
            , cssTransition = c.getCssAttrName('transition')
            , cssTransform = c.getCssAttrName('transform')
        ;

        c.drag(eDrag, function (params) {
            currentY =y+ params.top;

            eDrag.style.setProperty(cssTransform, 'translate3d(0,' + currentY + 'px,0)');
            //console.log(params);

            params.event.preventDefault();
        }, function () {
            y = currentY;
        }, function () {

        });

    </script>

</body>

</html>
