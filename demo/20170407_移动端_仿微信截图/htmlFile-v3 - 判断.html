<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>Html5 Ajax 上传文件</title>
    <style type="text/css">

        @charset "utf-8";
        /*--------------- reset ---------------*/
        *:before, *:after {
            box-sizing: border-box;
        }

        *, *:before, *:after {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        html, body, div, span, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, address, cite, code, del, dfn, em, img, ins, kbd, q, samp, small, strong, sub, sup, var, b, i, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td {
            border: 0 none;
            font-size: inherit;
            color: inherit;
            margin: 0;
            padding: 0;
            vertical-align: baseline;
            /* 在X5新内核Blink中，在排版页面的时候，会主动对字体进行放大，会检测页面中的主字体，当某一块字体在我们的判定规则中，认为字号较小，并且是页面中的主要字体，就会采取主动放大的操作。然而这不是我们想要的，可以采取给最大高度解决 */
            max-height: 100000px;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: normal;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "\5FAE\8F6F\96C5\9ED1", Arial, sans-serif;
            line-height: 1.5;
            color: #333;
            background-color: #fff;
            font-size: 0.24rem;
        }

        a {
            text-decoration: none;
        }

        /* HTML5 */
        article, aside, details, figcaption, figure,
        footer, header, hgroup, menu, nav, section {
            display: block;
        }

        blockquote, q {
            quotes: none;
        }

        blockquote:before, blockquote:after, q:before, q:after {
            content: '';
            content: none;
        }

        address, cite, dfn, em, var {
            font-style: normal;
        }

        code, kbd, pre, samp, tt {
            font-family: "Consolas", "Courier New", Courier, monospace;
        }

        em, strong {
            font-weight: bolder;
        }

        i {
            font-style: normal;
        }

        ul, ol, li {
            list-style: none;
        }

        table {
            border-collapse: collapse;
            border-spacing: 0;
        }

        /*------------------------------------------*/
        button, input, textarea {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            -webkit-user-modify: read-write-plaintext-only;
        / / -webkit-user-modify有个副作用，就是输入法不再能够输入多个字符
        }

        input, select {
            -webkit-appearance: none;
            appearance: none;
        }

        select::-ms-expand {
            display: none;
        }

        input[type=radio]::-ms-check,
        input[type=checkbox]::-ms-check {
            display: none;
        }

        input[type=text]::-ms-clear,
        input[type=tel]::-ms-clear,
        input[type=number]::-ms-clear {
            display: none;
        }

        a, img {
            -webkit-touch-callout: none
        }

        /*--------------- other ---------------*/
        img {
            border: 0 none;
        }

        textarea {
            resize: vertical;
        }

        a, button {
            cursor: pointer;
        }

        input {
            border: 0;
            outline: none;
        }

        .clr {
            clear: both;
        }

        .clr:after {
            content: ".";
            display: block;
            height: 0;
            line-height: 0;
            clear: both;
            visibility: hidden;
            font-size: 0;
        }

        .clr {
            *zoom: 1;
        }

        .tc {
            text-align: center;
        }

        .fl {
            float: left;
        }

        .no-ime {
            ime-mode: disabled;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background: #fff;
            padding-bottom: 0.92rem;
        }

        .mw {
            max-width: 100%;
        }

        /**/
        header {
            height: 0.88rem;
            background: #232427;
            font-size: 0.36rem;
            color: #fff;
            text-align: center;
            line-height: 0.88rem;
        }

        .idx-top {
            position: relative;
            height: 3.3rem;
            overflow: hidden;
            background-size: contain;
        }

        .idx-top .bgImg {
            /*position: absolute;*/
            /*left: 0;*/
            /*top: 0;*/
            /*width: 100%;*/
            /*z-index: 1;*/
            /*transform: translateY(-50%);*/
            /*top: 50%;*/
        }

        .idx-top .edit-btn {
            position: absolute;
            z-index: 2;
            top: 0.3rem;
            right: 0.3rem;
            color: #fff;
            font-size: 0.28rem;
        }

        .idx-top .edit-btn img {
            width: 0.36rem;
            vertical-align: middle;
            margin-right: 0.1rem;
        }

        .idx-top .main {
            position: relative;
            z-index: 2;
            text-align: center;
            font-size: 0.32rem;
            color: #fff;
            padding-top: 0.5rem;
            line-height: 1;
        }

        .idx-top .main img {
            display: block;
            margin: 0 auto;
            width: 1.6rem;
            height: 1.6rem;
            border-radius: 50%;
            -webkit-border-radius: 50%;
            margin-bottom: 0.25rem;
        }

        .product-list {
            padding: 0.1rem 4% 0 4%;
        }

        .product-list li {
            border-bottom: 0.02rem solid #ebebeb;
            padding: 0.2rem 0;
            overflow: hidden;
        }

        .product-list li .pic {
            width: 1.52rem;
            height: 1.52rem;
            float: left;
        }

        .product-list li .txt {
            overflow: hidden;
            padding-left: 0.25rem;
            font-size: 0.32rem;
            color: #333;
        }

        .product-list li .txt .price {
            color: #f15d15;
            padding-top: 0.1rem;
        }

        .pages {
            padding: 0.2rem 4%;
            overflow: hidden;
        }

        .pages a {
            width: 44.4%;
            height: 0.76rem;
            font-size: 0.32rem;
            text-align: center;
            line-height: 0.76rem;
            border: 0.02rem solid #4392ce;
            color: #4392ce;
            border-radius: 0.04rem;
            -webkit-border-radius: 0.04rem;
        }

        .pages a.prev {
            float: left;
        }

        .pages a.next {
            float: right;
        }

        .pages a.disabled {
            color: #bdbdbd;
            border: 0.02rem solid #bdbdbd;
        }

        .openShop {
            font-size: 0.32rem;
            color: #4392ce;
            text-align: center;
            padding: 0.2rem 0;
        }

        .openShop img {
            vertical-align: middle;
            width: 0.4rem;
            margin-right: 0.1rem;
        }

        .fix-nav {
            position: fixed;
            width: 100%;
            left: 0;
            bottom: 0;
            height: 0.9rem;
            line-height: 0.9rem;
            border-top: 0.02rem solid #ccc;
            text-align: center;
            background: #fafafa;
        }

        .fix-nav a {
            float: left;
            width: 33.3333%;
            border-right: 0.02rem solid #ccc;
            font-size: 0.3rem;
            color: #464646;
        }

        .fix-nav a:last-child {
            border-right: 0;
        }

        /*如何成为店主*/
        .howTxt,
        .idx-top #editFace {
            position: absolute;
            left: 0;
            bottom: 0;
            z-index: 2;
            width: 100%;
            height: 0.82rem;
            line-height: 0.82rem;
            text-align: center;
            background: rgba(0, 0, 0, 0.4);
            font-size: 0.32rem;
            color: #fff;
        }

        .idx-top #editFace input {
            opacity: 0;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
        }

        .become-master {
            padding: 0 6%
        }

        .become-master h2 {
            padding: 0.3rem 0;
            text-align: center;
            font-size: 0.24rem;
            color: #333;
        }

        .become-master .code {
            width: 5rem;
            margin: 0 auto;
            padding-bottom: 0.2rem;
        }

        .become-master .code img {
            width: 100%;
        }

        .become-master .txt .row {
            border-bottom: 0.02rem solid #ebebeb;
            padding: 0.1rem 0;
        }

        .become-master .txt .num {
            font-size: 0.32rem;
            color: #bdbdbd;
        }

        .become-master .txt p {
            font-size: 0.28rem;
            color: #333;
            line-height: 0.44rem;
        }

        /*修改资料*/
        .edit-resource .row {
            padding: 0.3rem;
            overflow: hidden;
            border-bottom: 0.02rem solid #ebebeb;
            line-height: 0.6rem;
        }

        .edit-resource .row span {
            font-size: 0.32rem;
            color: #999;
            float: left;
        }

        .edit-resource .row a {
            float: right;
            position: relative;
            padding-right: 0.35rem;
            text-align: right;
            font-size: 0.32rem;
            color: #333;
        }

        .edit-resource .row a .arrow {
            width: 0.22rem;
            height: 0.32rem;
            position: absolute;
            right: 0;
            top: 0.14rem;
        }

        .edit-resource .row a .avater {
            width: 0.6rem;
            height: 0.6rem;
            border-radius: 50%;
            -webkit-border-radius: 50%;
            vertical-align: middle;
        }

        .edit-resource .row .img {
            width: 1rem;
            height: 1rem;
            overflow: hidden;
        }

        .edit-code {
            padding: 0.5rem 0;
            width: 3.4rem;
            margin: 0 auto;
        }

        .edit-code .img {
            width: 3.4rem;
            height: 3.4rem;
            margin-bottom: 0.1rem;
            overflow: hidden;
        }

        .edit-code #editCode {
            position: relative;
            display: block;
            height: 0.8rem;
            text-align: center;
            line-height: 0.8rem;
            background: #4392ce;
            color: #fff;
            font-size: 0.32rem;
        }

        .edit-code #editCode input {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
        }

        /*修改店名*/
        .eidt-shopName .row {
            border-bottom: 0.02rem solid #ebebeb;
        }

        .eidt-shopName .row input {
            padding: 0.2rem 4%;
            width: 100%;
            height: 1.2rem;
            line-height: 0.8rem;
            display: block;
            color: #333;
            font-size: 0.32rem;
        }

        .eidt-shopName .btn {
            margin: 0.3rem 4%;
        }

        .eidt-shopName .btn input {
            display: block;
            width: 100%;
            height: 0.9rem;
            text-align: center;
            line-height: 0.9rem;
            background: #4392ce;
            color: #fff;
            font-size: 0.32rem;
            border-radius: 0.04rem;
            -webkit-border-radius: 0.04rem;
        }

        .picture-zoom {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 2;
            overflow: hidden;
            background-color: #000;
            pointer-events: none;
            -webkit-transform: scale(0.8, 0.8);
            transform: scale(0.8, 0.8);
            opacity: 0;
            -webkit-transition: 0.2s ease-out;
            transition: 0.2s ease-out;
        }

        .picture-zoom > img {
            opacity: .5;
        }

        .picture-zoom.show {
            pointer-events: auto;
            -webkit-transform: scale(1, 1);
            transform: scale(1, 1);
            opacity: 1;
        }

        .picture-zoom .select {

            background-color: rgba(255, 255, 255, 0.5);
            position: absolute;
            box-sizing: border-box;
            overflow: hidden;
        }

        .picture-zoom a {
            position: absolute;
            top: 0;
            z-index: 7;
            color: #fff;
            font-size: 40px;
        }

        .picture-zoom a.c {
            left: 20px;
        }

        .picture-zoom a.s {
            right: 20px;
        }

        /*loader*/
        .preloader-indicator-modal {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            z-index: 99;
            pointer-events: none;
            opacity: 0;
            -webkit-transition: 0.2s ease-out;
            transition: 0.2s ease-out;

        }

        .preloader-indicator-modal.show {
            pointer-events: auto;
            opacity: 1;
        }

        .preloader-indicator-modal .preloader {
            position: absolute;
            left: 50%;
            top: 50%;
            padding: 8px;
            margin-left: -25px;
            margin-top: -25px;
            background: rgba(0, 0, 0, 0.8);
            z-index: 11000;
            border-radius: 5px;
        }

        .preloader-indicator-modal .preloader::after {
            content: '';
            display: block;
            width: 68px;
            height: 68px;
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg%20viewBox%3D'0%200%20120%20120'%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20xmlns%3Axlink%3D'http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink'%3E%3Cdefs%3E%3Cline%20id%3D'l'%20x1%3D'60'%20x2%3D'60'%20y1%3D'7'%20y2%3D'27'%20stroke%3D'%23fff'%20stroke-width%3D'11'%20stroke-linecap%3D'round'%2F%3E%3C%2Fdefs%3E%3Cg%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(30%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(60%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(90%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(120%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(150%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.37'%20transform%3D'rotate(180%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.46'%20transform%3D'rotate(210%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.56'%20transform%3D'rotate(240%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.66'%20transform%3D'rotate(270%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.75'%20transform%3D'rotate(300%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.85'%20transform%3D'rotate(330%2060%2C60)'%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E");
            background-position: 50%;
            background-size: 100%;
            background-repeat: no-repeat;
            -webkit-animation: preloader-spin 1s steps(12, end) infinite;
            animation: preloader-spin 1s steps(12, end) infinite;
        }

        @-webkit-keyframes preloader-spin {
            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes preloader-spin {
            100% {
                transform: rotate(360deg);
            }
        }


    </style>

    <script type="text/javascript">
        !function (e) {
            function t(a) {
                if (i[a])return i[a].exports;
                var n = i[a] = {exports: {}, id: a, loaded: !1};
                return e[a].call(n.exports, n, n.exports, t), n.loaded = !0, n.exports
            }

            var i = {};
            return t.m = e, t.c = i, t.p = "", t(0)
        }([function (e, t) {
            "use strict";
            Object.defineProperty(t, "__esModule", {value: !0});
            var i = window;
            t["default"] = i.flex = function (e, t) {
                var a = e || 100, n = t || 1, r = i.document, o = navigator.userAgent,
                    d = o.match(/Android[\S\s]+AppleWebkit\/(\d{3})/i), l = o.match(/U3\/((\d+|\.){5,})/i),
                    c = l && parseInt(l[1].split(".").join(""), 10) >= 80,
                    p = navigator.appVersion.match(/(iphone|ipad|ipod)/gi), s = i.devicePixelRatio || 1;
                p || d && d[1] > 534 || c || (s = 1);
                var u = 1 / s, m = r.querySelector('meta[name="viewport"]');
                m || (m = r.createElement("meta"), m.setAttribute("name", "viewport"), r.head.appendChild(m)), m.setAttribute("content", "width=device-width,user-scalable=no,initial-scale=" + u + ",maximum-scale=" + u + ",minimum-scale=" + u), r.documentElement.style.fontSize = a / 2 * s * n + "px"
            }, e.exports = t["default"]
        }]);
        flex(100, 1);
    </script>

</head>
<body>
<div class="idx-top">
    <img id="img1" class="bgImg"/>
    <!-- 建议上传背景图大小为 750*330 -->
    <div id="editFace">上传图片一</div>

</div>
<div class="edit-resource">
    <div class="row clr" id="editAva">
        <span>上传图片二</span>
        <div class="img"><img class='avater' id="img2" src="<?php echo 'test.jpg'?>"/></div>
    </div>
    <div class="edit-code">
        <div class="img">
            <img id="img3"/>
        </div>

        <div id="editCode">
            <span>上传图片三</span>
        </div>
    </div>
</div>
<div id="info"></div>
<div class="preloader-indicator-modal" id="preloader">
    <div class="preloader"></div>
</div>
<script src="zoom-picture.js"></script>
<script type="text/javascript">

    imgupload({
        btn: editFace,
        img: img1,
        url: '',
        whs: 750 / 330

    });
    imgupload({
        btn: editAva,
        img: img2,
        url: ''

    });
    imgupload({
        btn: editCode,
        img: img3,
        url: ''

    });
    function imgupload(params) {
        var
            btn = params.btn,
            url = params.url,
            img = params.img,
            whs = params.whs || 1,
            transform = c.getRightCssName('transform')[1];

        btn.addEventListener('click', function () {

            fileSelect(function (files) {

                var file = files[0];
                //是否是图片
                var imageType = /^image\//;
                if (!imageType.test(file.type)) {
                    alert("请选择图片！");
                    return;
                }
                //判断图片大小
                if (file.size >= 524288) {
                    alert("图片不能大于512k");
                    return;
                }

                var oReader = new FileReader();
                oReader.onload = function (e) { //文件读取完后触发
                    var src = e.target.result;
                    zoomPicture(src, function (x, y, w, h, scale, imgw, imgh) {
                        var imgBox = img.parentElement,
                            bw = imgBox.clientWidth,
                            s = bw / w;

//                        img.style.setProperty(transform, 'translate3d(' + (-x * s) + 'px,' + (-y * s) + 'px,0)');
                        img.style[transform] = 'translate3d(' + (-x * s) + 'px,' + (-y * s) + 'px,0)';
                        img.width = imgw * s;
                        img.height = imgh * s;
                        img.src = src;

                        console.log('裁图参数xywh：', x / scale, y / scale, w / scale, h / scale);

                        preloader.classList.add('show');
                        // 上传
                        uploadfile({
                            url: url + '&x=' + (x / scale) + '&y=' + (y / scale) + '&w=' + (w / scale) + '&h=' + (h / scale),
                            file: file,
                            /*progress: function (loaded, total) {
                             // 此处为进度

                             var v = ~~(loaded / total * 100),
                             v2 = v + '%',
                             str = v2;
                             if (v === 100) str = '处理中..';

                             console.log(v, v2, str);
                             },*/
                            success: function (d) {
                                img.src = d;
                                console.log(d);
                            },
                            complete: function () {
                                preloader.classList.remove('show');
                            }
                        });

                    }, whs);
                };
                oReader.readAsDataURL(file);


            });

        });

    }
    // 文件选择
    function fileSelect(cb) {
        var file = document.createElement('input');

        file.type = 'file';
        file.style.display = 'none';

        file.onchange = function () {
            cb(file.files);
            file.remove();
        };

        document.body.appendChild(file);
        file.click();
    }

    // 图片预览
    function preview(params) {
        var img = params.img,
            file = params.file;

        var oReader = new FileReader();
        //是否是图片
        var imageType = /^image\//;
        console.log(file.type)
        if (!imageType.test(file.type)) {
            alert("请选择图片！");
            return;
        }
        console.log(file.size);
        //判断图片大小
        if (file.size >= 524288) {
            alert("图片不能大于512k");
            return;
        }
        oReader.onload = function (e) { //文件读取完后触发
            img.src = e.target.result;//取数据
        };

        oReader.readAsDataURL(file);
    }

    // 文件上传
    function uploadfile(params) {
        var url = params.url,
            file = params.file,
            success = params.success,
            progress = params.progress || function () {
                },
            error = params.error || function () {
                },
            complete = params.complete || function () {
                }
        ;

        var vFD = new FormData();
        vFD.append("file", file);

        var xhr = new XMLHttpRequest();

        xhr.upload.addEventListener('progress', function (e) {
            if (e.lengthComputable) {
                progress(e.loaded, e.total);
            }
        }, false);

        xhr.addEventListener('readystatechange', function () {
            if (xhr.readyState === 4) {

                if (xhr.status === 200) {
                    success(xhr.responseText);

                }
                else {
                    error(xhr, xhr.status, arguments);
                }

                complete();
            }
        }, false);

        xhr.open("post", url);
        xhr.send(vFD);

    }

</script>
</body>
</html>