<!DOCTYPE html>
<html>

<head>
    <title></title>

    <meta content="width=device-width,initial-scale=1.0,user-scalable=no" name="viewport" />

    <style>
        body {
            /*padding:40px;*/
        }

        .div1 {
            height: 300px;
            width: 300px;
            background: url(dish.png) no-repeat;
            background-size:100% auto;
            border-radius:50%;
            position:relative;
        }
    </style>
</head>

<body>
    <div id="info" name="test2">xxx</div>
    <div id="div1" class="div1"></div>
    <script src="../../js/common.js"></script>
    <script src="jquery-1.11.0.js"></script>
    <script src="jquery.easing.1.3.js"></script>
    <script>

        function easeInOutQuad(x, t, b, c, d) {
            if ((t /= d / 2) < 1) return c / 2 * t * t + b;
            return -c / 2 * ((--t) * (t - 2) - 1) + b;
        };
        var i = 0, len =300, halfLen = len/2
            , prev = 0, v, isFinish = false

            , deg = 0// 当前角度
            , goalDeg=900

            , cssTransform = c.getCssName('transform')

            ,prizeId = 5,

            prizes = {
                0: {
                    0: 0,
                    1: 60
                },
                1: {
                    0: 60,
                    1: 60
                }
            }
        ;

        prizesDataBuild();


        div1.onclick = function () {
            isFinish = true;

        };

        loop();


        function loop() {

            requestAnimationFrame(function () {

                i++;

                if (i > halfLen && isFinish === false) {
                    i = halfLen;
                }

                if (isFinish && i > halfLen) {
                    goalDegUpdate();
                    v = easeInOutQuad(null, i, 0, goalDeg, len);
                    prev = easeInOutQuad(null, i - 1, 0, goalDeg, len);

                    deg += v - prev;
                }
                else {
                    v = easeInOutQuad(null, i, 0, goalDeg, len);
                    prev = easeInOutQuad(null, i - 1, 0, goalDeg, len);

                    deg += v - prev;
                }

                div1.style[cssTransform] = 'rotate3d(0,0,1,' + deg + 'deg)';

                if (i < len) loop();

            });
        }

        
        function goalDegUpdate() {

            if (goalDegUpdate.noFirst === undefined) {

                var rDeg = deg - ~~(deg / 360) * 360,
                    easeDeg = (360 + prizes[prizeId][0] - rDeg + 15);

                easeDeg %= 360;
                console.log(easeDeg);

                if (easeDeg < 226) {
                    easeDeg += 360;
                }


                goalDeg = easeDeg * 2;

                console.log(goalDeg);

                goalDegUpdate.noFirst = 1;
            }

        }



        function prizesDataBuild() {
            for (var i = 0, count = 6; i < count; i++) {
                prizes[i] = {
                    0: i * 360 / count,
                    1: 360 / count
                };
            }
        }

    </script>
</body>

</html>
